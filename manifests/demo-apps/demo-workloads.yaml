---
apiVersion: v1
kind: Namespace
metadata:
  name: demo-apps
  labels:
    environment: demo
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vulnerable-web-app
  namespace: demo-apps
  labels:
    app: vulnerable-web-app
    team: frontend
  annotations:
    kuberule.io/owner: "frontend-team@company.com"
    kuberule.io/dashboard: "https://grafana.company.com/d/vulnerable-web-app"
    kuberule.io/runbook: "https://wiki.company.com/runbooks/vulnerable-web-app"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: vulnerable-web-app
  template:
    metadata:
      labels:
        app: vulnerable-web-app
        version: v1.0.0
        team: frontend
      annotations:
        kuberule.io/owner: "frontend-team@company.com"
        owner: "frontend-team"
    spec:
      containers:
      - name: web
        image: nginx:1.27.0  # Updated to newer version
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: legacy-api
  namespace: demo-apps
  labels:
    app: legacy-api
    team: backend
  annotations:
    kuberule.io/owner: "backend-team@company.com"
    kuberule.io/dashboard: "https://grafana.company.com/d/legacy-api"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: legacy-api
  template:
    metadata:
      labels:
        app: legacy-api
        version: v0.8.5
        team: backend
      annotations:
        kuberule.io/owner: "backend-team@company.com"
    spec:
      containers:
      - name: api
        image: redis:6.0.9  # Older Redis with known CVEs
        ports:
        - containerPort: 6379
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: payment-service
  namespace: demo-apps
  labels:
    app: payment-service
    team: payments
    critical: "true"
  annotations:
    kuberule.io/owner: "payments-team@company.com"
    kuberule.io/dashboard: "https://grafana.company.com/d/payment-service"
    kuberule.io/runbook: "https://wiki.company.com/runbooks/payment-service"
spec:
  replicas: 3
  selector:
    matchLabels:
      app: payment-service
  template:
    metadata:
      labels:
        app: payment-service
        version: v2.1.0
        team: payments
        critical: "true"
      annotations:
        kuberule.io/owner: "payments-team@company.com"
    spec:
      containers:
      - name: payment
        image: node:14-alpine  # Older Node.js version with vulnerabilities
        command: ["node", "-e", "console.log('Payment service running')"]
        ports:
        - containerPort: 3000
        resources:
          requests:
            memory: "256Mi"
            cpu: "200m"
          limits:
            memory: "512Mi"
            cpu: "500m"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: unpatched-service
  namespace: demo-apps
  labels:
    app: unpatched-service
    team: infrastructure
  annotations:
    kuberule.io/owner: "infra-team@company.com"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: unpatched-service
  template:
    metadata:
      labels:
        app: unpatched-service
        version: legacy
        team: infrastructure
      annotations:
        kuberule.io/owner: "infra-team@company.com"
    spec:
      containers:
      - name: service
        image: python:3.7-slim  # Older Python with known CVEs
        command: ["python", "-c", "print('Running')"]
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: insecure-db-proxy
  namespace: demo-apps
  labels:
    app: insecure-db-proxy
    team: database
  annotations:
    kuberule.io/owner: "database-team@company.com"
    kuberule.io/dashboard: "https://grafana.company.com/d/db-proxy"
spec:
  replicas: 2
  selector:
    matchLabels:
      app: insecure-db-proxy
  template:
    metadata:
      labels:
        app: insecure-db-proxy
        version: v1.2.3
        team: database
      annotations:
        kuberule.io/owner: "database-team@company.com"
    spec:
      containers:
      - name: proxy
        image: postgres:11.8  # Older PostgreSQL with vulnerabilities
        env:
        - name: POSTGRES_PASSWORD
          value: "demo123"
        ports:
        - containerPort: 5432
        resources:
          requests:
            memory: "256Mi"
            cpu: "200m"
          limits:
            memory: "512Mi"
            cpu: "500m"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: monitoring-agent
  namespace: demo-apps
  labels:
    app: monitoring-agent
    team: observability
  annotations:
    kuberule.io/owner: "observability-team@company.com"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: monitoring-agent
  template:
    metadata:
      labels:
        app: monitoring-agent
        version: v3.0.1
        team: observability
      annotations:
        kuberule.io/owner: "observability-team@company.com"
        kuberule.io/dashboard: "https://grafana.company.com/d/monitoring-agent"
        kuberule.io/runbook: "https://wiki.company.com/runbooks/monitoring"
    spec:
      containers:
      - name: agent
        image: prom/prometheus:v2.28.0  # Older Prometheus version
        ports:
        - containerPort: 9090
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"

